
	<div  ng-controller="ManageAppCtrl">
		
		<div class="panel panel-primary">
		<div class="panel-heading">
		  	<p ng-hide="app._id">Register a new plugin</p>
			<p ng-show="app._id">Manage Plugin</p>
		</div>
		<div class="body">
		
		<form name="myform" novalidate role="form" class="form-horizontal" ng-submit="updateApp()">
		  <p ng-show="error && !error.field" translate="{{ error.code }}" ng-class="{ 'alert-warning' : error.level == 'warning', 'alert-danger' : !error.level }" class="alert">	                          
	      </p>	
		  <formrow myid="filename" label="Internal Name">
		    <input type="text" id="filename" name="filename" class="form-control" placeholder="Filename" ng-model="app.filename" autofocus required>
		    <p class="help-block" translate="manageapp.info.filename"></p>
		  </formrow>
		  <formrow myid="targetUserRole" label="Target Role">
		    <select id="targetUserRole" name="targetUserRole" class="form-control" ng-model="app.targetUserRole" ng-options="role.value as role.label for role in targetUserRoles" required></select>
		    <p class="help-block" translate="manageapp.info.targetUserRole"></p>
		  </formrow>
		  <formrow myid="type" label="Type">
		    <select id="type" name="type" class="form-control" ng-model="app.type" ng-options="type.value as type.label for type in types" required></select>
		    <p class="help-block" translate="manageapp.info.type"></p>
		  </formrow>
		  <formrow myid="requirements" label="Requirements">
		    <div class="checkbox" ng-repeat="req in requirements">
		      <label>
		        <input type="checkbox" ng-checked="app.requirements.indexOf(req)>=0" ng-click="toggle(app.requirements, req)">
		        <span translate="{{ 'enum.userfeature.'+req }}"></span>
		      </label>
		    </div>
		  </formrow>		  		  
		  <hr>
		  <formrow myid="name" label="Name">
		    <input type="text" id="name" name="name" class="form-control" placeholder="Name" ng-model="app.name" required>
		    <p class="help-block" translate="manageapp.info.name"></p>
		  </formrow>
		  <formrow myid="description" label="Description">
		    <textarea rows="5" id="description" name="description" class="form-control" placeholder="Description" ng-model="app.description" required></textarea>
		    <p class="help-block" translate="manageapp.info.description"></p>
		  </formrow>
		  <formrow myid="defaultSpaceName" label="Tile Name" ng-show="app.type != 'mobile'">
		    <input type="text" id="defaultSpaceName" name="defaultSpaceName" class="form-control" placeholder="Tile Name" ng-model="app.defaultSpaceName">
		    <p class="help-block" translate="manageapp.info.defaultSpaceName"></p>
		  </formrow>
		   <formrow myid="orgName" label="Organization Name">
		    <input type="text" id="orgName" name="orgName" class="form-control" placeholder="Name" ng-model="app.orgName">		 
		  </formrow>
		 
		 
		  <hr>
		  <formrow myid="x" label="Multi Language Support">
		    <div class="help-block">
		    <span ng-repeat="l in languages">
		      <span ng-show="app.i18n[l].name"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{{l}} </span>		      
		    </span>
		    </div>
		  </formrow>
		  <formrow myid="lang" label="I18n Language Selection">
		    <select id="lang" name="lang" class="form-control" ng-model="sel.lang" ng-options="lang for lang in languages"></select>		    
		  </formrow>
		  <formrow myid="name_i18n" label="I18n Name">		    
		    <input type="text" id="name_i18n" name="name_i18n" class="form-control" placeholder="Name" ng-model="app.i18n[sel.lang].name">
		  </formrow>
		  <formrow myid="description_i18n" label="I18n Description">
		    <textarea rows="5" id="description_i18n" name="description_i18n" class="form-control" placeholder="Description" ng-model="app.i18n[sel.lang].description"></textarea>
		  </formrow>
		  <formrow myid="defaultSpaceName_i18n" label="I18n Tile Name" ng-show="app.type != 'mobile'">		    
		    <input type="text" id="defaultSpaceName_i18n" name="defaultSpaceName_i18n" class="form-control" placeholder="Tile Name" ng-model="app.i18n[sel.lang].defaultSpaceName">
		  </formrow>
		  <hr>		  
		  <formrow myid="tags" label="Tags">
		    <div class="checkbox" ng-repeat="tagdef in tags">
		      <label>
		        <input type="checkbox" ng-checked="app.tags.indexOf(tagdef)>=0" ng-click="toggle(app.tags, tagdef)">
		        {{ tagdef }}
		      </label>
		    </div>
		    <p class="help-block" translate="manageapp.info.tags"></p>
		  </formrow>  		
		
		  <formrow myid="url" label="URL" ng-hide="app.type == 'mobile'">
		    <input type="text" id="url" name="url" class="form-control" placeholder="URL (must include &quot;:authToken&quot;)" ng-model="app.url">
		    <formerror myid="url" type="authToken" message="Url must contain ':authToken' to receive the authorization token required to create records." ></formerror>
		    <p class="help-block" translate="manageapp.info.url"></p>
		  </formrow>
		  <formrow myid="previewUrl" label="Dashboard Tile URL" ng-hide="app.type == 'mobile'">
		    <input type="text" id="previewUrl" name="previewUrl" class="form-control" placeholder="URL (must include &quot;:authToken&quot;)" ng-model="app.previewUrl">
		    <p class="help-block" translate="manageapp.info.previewUrl"></p>
		  </formrow>		 
		  <formrow myid="defaultSpaceContext" label="Default Dashboard" ng-show="app.type != 'mobile'">
		    <input type="text" id="defaultSpaceContext" name="defaultSpaceContext" class="form-control" placeholder="Dashboard Name" ng-model="app.defaultSpaceContext">
		    <p class="help-block" translate="manageapp.info.defaultSpaceContext"></p>
		  </formrow>
		  <formrow myid="query" label="manageapp.access_query_options">
		    <div class="checkbox">
		      <label>
		      <input type="checkbox" ng-model="query.self" ng-change="patchQuery('owner')">
		      <span translate="manageapp.query.self"></span></label>
		    </div>
		    <div class="checkbox">
		      <label>
		      <input type="checkbox" ng-model="query.ownapp" ng-change="patchQuery('app')">
		      <span translate="manageapp.query.ownapp"></span></label>
		    </div>
		    <div class="checkbox" ng-show="app.type == 'mobile'">
		      <label>
		      <input type="checkbox"  ng-model="query.learn" ng-change="patchQuery('learn')">
		      <span translate="manageapp.query.learn"></span></label>
		    </div>
		    <div class="checkbox">
		      <label>
		      <input type="checkbox"  ng-model="query.all" ng-change="patchQuery('group')">
		      <span translate="manageapp.query.all"></span></label>
		    </div>
		   </formrow> 
		   <formrow myid="queryadd" label="manageapp.access_query_add">
		    <div class="col-sm-5">
		      <select class="form-control" ng-model="query.system" ng-options="cs as cs.label | translate for cs in codesystems"></select>
		    </div>
		    <div class="col-sm-5">
		      <input type="text" class="form-control" id="queryadd" name="queryadd" ng-model="query.code">
		    </div>
		    <div class="col-sm-2">
		      <button class="btn btn-default" type="button" ng-click="addCode()" translate="common.add_btn"></button>
		    </div>	
		    <div class="col-sm-12" ng-show="codeerror">
		    <p class="help-block"  translate="{{codeerror}}"></p>
		    </div>
		   </formrow>
		   <formrow myid="query" label="manageapp.access_query_selection" ng-show="labels.length">		    
		    <div ng-repeat="label in labels" class="checkbox">
		      <label>
		      <input type="checkbox" ng-model="label.selected" ng-change="patchQuery(label.type, label)">
		      {{ label.label }}</label>
		    </div>
		  </formrow>
		  <formrow myid="defaultQuery" label="manageapp.access_query_json">
		    <textarea rows="5" id="defaultQuery" name="defaultQuery" class="form-control" placeholder="Description" ng-change="updateQuery()" ng-model="app.defaultQueryStr"></textarea>
		    <formerror myid="defaultQuery" type="json" message="error.invalid.json" ></formerror>
		    <formerror myid="defaultQuery" type="invalid" message="error.invalid.access_query" ></formerror>
		    <p class="help-block" ng-show="app.type == 'mobile'" translate="manageapp.info.defaultQuery_mobile"></p> 
		    <p class="help-block" ng-hide="app.type == 'mobile'" translate="manageapp.info.defaultQuery"></p>
		    
		  </formrow>
		  <formrow myid="writes" label="Write Mode">
		    <select class="form-control" name="writes" ng-model="app.writes" ng-options="mode as ('enum.writepermissiontype.'+mode)|translate for mode in writemodes"></select>
		  </formrow>	
		  <formrow myid="resharesData" label="Resharing">
		    <div class="checkbox">
		    <label>
		      <input type="checkbox" id="resharesData" name="resharesData" ng-model="app.resharesData" value="true">
		      <span translate="manageapp.info.resharesData"></span>
		    </label>
		    </div>
		  </formrow>
		   <formrow myid="allowsUserSearch" label="User Search" ng-show="app.type == 'mobile'">
		    <div class="checkbox">
		    <label>
		      <input type="checkbox" id="allowsUserSearch" name="allowsUserSearch" ng-model="app.allowsUserSearch" value="true">
		      <span translate="manageapp.info.allowsUserSearch"></span>
		    </label>
		    </div>
		  </formrow>	
		  
		
		  
		  		 
		  <formrow myid="authorizationUrl" label="Authorization URL" ng-show="app.type == 'oauth1' || app.type == 'oauth2'">
		    <input type="text" id="authorizationUrl" name="authorizationUrl" class="form-control" placeholder="Authorization URL" ng-model="app.authorizationUrl">
		  </formrow>
		  <formrow myid="accessTokenUrl" label="Access Token URL" ng-show="app.type == 'oauth1' || app.type == 'oauth2'">
		    <input type="text" id="accessTokenUrl" name="accessTokenUrl" class="form-control" placeholder="Access token URL" ng-model="app.accessTokenUrl">
		  </formrow>
		  <formrow myid="consumerKey" label="Consumer Key" ng-show="app.type == 'oauth1' || app.type == 'oauth2'">
		    <input type="text" id="consumerKey" name="consumerKey" class="form-control" placeholder="Consumer key" ng-model="app.consumerKey">
		  </formrow>
		  <formrow myid="consumerSecret" label="Consumer Secret" ng-show="app.type == 'oauth1' || app.type == 'oauth2'">
		    <input type="text" id="consumerSecret" name="consumerSecret" class="form-control" placeholder="Consumer secret" ng-model="app.consumerSecret">
		  </formrow>
		  <formrow myid="requestTokenUrl" label="Request Token URL" ng-show="app.type == 'oauth1'">
		    <input type="text" id="requestTokenUrl" name="requestTokenUrl" class="form-control" placeholder="Request token URL" ng-model="app.requestTokenUrl">
		  </formrow>
		  <formrow myid="scopeParameters" label="Scope Parameters" ng-show="app.type == 'oauth2'">
		    <input type="text" id="scopeParameters" name="scopeParameters" class="form-control" placeholder="Scope parameters" ng-model="app.scopeParameters">
		  </formrow>
		  <formrow myid="secret" label="Application Secret" ng-show="app.type == 'mobile'">
		    <input type="text" id="secret" name="secret" class="form-control" placeholder="Secret" ng-model="app.secret">
		    <p class="help-block" translate="manageapp.info.secret"></p>
		  </formrow>
		  <formrow myid="redirectUri" label="Redirect URI (optional, required for OAuth2 login)" ng-show="app.type == 'mobile'">
		    <input type="text" id="redirectUri" name="redirectUri" class="form-control" placeholder="Redirect URI" ng-model="app.redirectUri">
		  </formrow>
		   <formrow myid="developmentServer" label="Development Server" ng-hide="app.type == 'mobile' || !app.developmentServer">
		    <p class="form-control-static">{{ app.developmentServer }}</p>
		  </formrow>
		   <formrow myid="unlockCode" label="manageapp.unlock_code" ng-show="app.type == 'mobile'">
		    <input type="text" id="unlockCode" name="unlockCode" class="form-control" ng-model="app.unlockCode">
		    <p class="help-block" translate="manageapp.info.unlock_code"></p>
		  </formrow>
		  <div ng-show="app.type == 'mobile' && app.targetUserRole != 'RESEARCH'">
		  <hr ng-show="app.type == 'mobile'">
		  <p class="alert alert-info" ng-show="app.type == 'mobile'" translate="manageapp.admin_only"></p>
		  <formrow myid="termsOfUse" label="manageapp.terms_of_use">
		    <input id="termsOfUse" type="text" ng-disabled="!allowStudyConfig" name="termsOfUse" class="form-control" ng-model="app.termsOfUse" autocomplete="off" uib-typeahead="term.id as term.fullname for term in terms | filter:{fullname:$viewValue}">
		    
		     <p class="help-block" ng-show="app.termsOfUse"><a ui-sref="^.terms({ which:app.termsOfUse })" translate="manageapp.show_terms"></a></p> 
		  </formrow>
		  <formrow myid="linkedStudy" label="manageapp.linkedStudy" >
		    <input type="text" id="linkedStudy" ng-disabled="!allowStudyConfig" name="linkedStudy" class="form-control" ng-change="checkStudyEmpty()" placeholder="Study" ng-model="app.linkedStudyCode">
		    <formerror myid="linkedStudy" type="invalid" message="error.unknown.study" ></formerror>
		     <p class="help-block">{{ app.linkedStudyName }}</p> 
		  </formrow>
		   <formrow myid="mustParticipateInStudy" label="manageapp.mustParticipateInStudy">
		    <div class="checkbox">
		    <label>
		      <input type="checkbox" id="mustParticipateInStudy" ng-disabled="!allowStudyConfig || !app.linkedStudyCode" name="mustParticipateInStudy" ng-model="app.mustParticipateInStudy" value="true">
		      <span translate="manageapp.info.mustParticipateInStudy"></span>
		    </label>
		    </div>
		  </formrow>
		  </div>
		  
		  <formrow myid="x" label="">
		    <button type="submit" ng-disabled="status.action=='submit'" class="btn btn-primary">Submit</button>
		    <button type="button" class="btn btn-default" ng-click="doInstall()" ng-hide="app.type == 'mobile'" ng-disabled="app._id == null">Install from localhost</button>
		    <a class="btn btn-default" ui-sref="^.autoimport({ appId : app._id })" ng-show="app.type == 'oauth1' || app.type == 'oauth2'" ng-disabled="app._id == null">Serverside Import Test</a>
		    		    
		    <button type="button" class="btn btn-danger" ng-show="allowDelete" ng-click="doDelete()" ng-disabled="status.action=='delete'" translate="common.delete_btn"></button>
		    
		  </formrow>
		  <formrow myid="x2" label="">
		    
		    <a class="btn btn-default" ui-sref="^.appmessages({ appId : app._id })" ng-disabled="app._id == null" translate="manageapp.messages_btn"></a>
		    <a class="btn btn-default" ui-sref="^.appstats({ appId : app._id })" ng-disabled="app._id == null" translate="manageapp.stats_btn"></a>
		    <a class="btn btn-default" ui-sref="^.appdebug({ appId : app._id })" ng-disabled="app._id == null" translate="manageapp.debug_btn"></a>
		    <button type="button" class="btn btn-default" ng-show="allowExport" ng-click="exportPlugin()" ng-disabled="status.action=='download'" translate="manageapp.export_btn"></button>
		    
		    
		  </formrow>
	     </form>	  
		  
		
	</div>
	</div></div>