
<div ng-controller="StudyDetailCtrl" ng-cloak>
	<div class="extraspace">
	  <button class="btn btn-default" ng-click="goBack();"><span class="glyphicon glyphicon-chevron-left"></span><span translate="common.back_btn"></span></button>
	</div>
	<div class="panel panel-primary">
		<div class="panel-heading" translate="studydetails.study"></div>
		<div class="panel-body">
			<p ng-show="error && !error.field" translate="{{ error.code }}" ng-class="{ 'alert-warning' : error.level == 'warning', 'alert-danger' : !error.level }" class="alert"></p>
			<p>{{ study.name }}</p>
			<p>{{ study.description }}</p>
		</div>
	</div>
	<div class="panel panel-primary">
		<div class="panel-heading" translate="studydetails.organization"></div>
		<div class="panel-body">
			<p>{{ research.name }}</p>
			<p>{{ research.description }}</p>
		</div>
	</div>
	<div class="panel panel-primary" ng-show="participation && study.assistance=='HCPROFESSIONAL'">
		<div class="panel-heading" translate="studydetails.providers_monitoring"></div>
		<div class="panel-body">
		    <p ng-show="providers.length == 0" translate="studydetails.no_providers">None</p>
			<div ng-repeat="prov in providers">
				<address>
					<strong>{{ prov.firstname }} {{ prov.lastname }}</strong><br>
					 {{ prov.address1 }}<br>
					 {{ prov.address2 }}<br> 
					 {{ prov.zip }} {{ prov.city }}<br> {{ 'enum.country'+prov.country | translate }}<br> <span ng-show="prov.phone"><span translate="common.user.phone"></span>: {{ prov.phone }}</span><br>
					<span ng-show="prov.mobile"><span translate="common.user.mobile_phone"></span>: {{ prov.mobile }}</span><br>
					<span ng-show="prov.email"><span translate="common.user.email"></span>: {{ prov.email }}</span><br>
				</address>
				<button class="btn btn-danger btn-xs" ng-click="removeProvider(prov);" translate="studydetails.provider_remove_btn"></button>
			</div>
			<div class="extraspace"></div>
			<button class="btn btn-default" ng-click="addProvider()" translate="studydetails.provider_add_btn"></button>
		</div>
	</div>
	<div class="panel panel-primary">
		<div class="panel-heading" translate="studydetails.information_that_needs_sharing"></div>
		<div class="panel-body">

			<ul>
				<li ng-show="needs('RESTRICTED')" translate="studydetails.information_restricted"></li>
				<li ng-show="needs('DEMOGRAPHIC')" translate="studydetails.information_demographic"></li>
				
				<li ng-repeat="(rule, params) in study.recordQuery">
			          <span ng-if="rule == 'format'">Records that have format:
			            <ul>
			              <li ng-repeat="format in params">{{ format }}</li>
			            </ul> 
			          </span>
			          <span ng-if="rule == 'format/*'">Records that have format:
			            <ul>
			              <li ng-repeat="format in params">{{ format }}</li>
			            </ul> 
			          </span>
			          <span ng-if="rule == 'content'">Records that have content:
			            <ul>
			              <li ng-repeat="content in params">{{ content }}</li>
			            </ul> 
			          </span>
			          <span ng-if="rule == 'content/*'">Records that have content:
			            <ul>
			              <li ng-repeat="content in params">{{ content }}</li>
			            </ul> 
			          </span>
			          <span ng-if="rule == 'group'">Records that belong to group:
			            <ul>
			              <li ng-repeat="group in params">{{ group }}</li>
			            </ul> 
			          </span>
			      </li>
				
			</ul>

		</div>
	</div>
	<div ng-show="participation.history.length" class="panel panel-primary">
		<div class="panel-heading">Participation History</div>
		<table class="table">
			<thead>
				<tr>
					<th>Event</th>
					<th>Who</th>
					<th>When</th>
					<th>Comment</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="entry in participation.history">
					<td>{{ entry.event }}</td>
					<td>{{ entry.whoName }}</td>
					<td>{{ entry.timestamp | date }}</td>
					<td>{{ entry.message }}</td>
				</tr>
			</tbody>
		</table>
	</div>
	


	<button ng-show="mayRequestParticipation()" ng-click="requestParticipation()" class="btn btn-success">Request Participation</button>
	<button ng-show="mayDeclineParticipation()" ng-click="noParticipation()" class="btn btn-danger">Do not participate</button>

    <div ng-include="'/views/shared/dashboard/dashboard.html'"></div>

</div>
