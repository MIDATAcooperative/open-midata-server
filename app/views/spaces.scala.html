@(spaceForm: Form[forms.SpaceForm], records: List[Record], spaces: List[Space], activeSpace: org.bson.types.ObjectId, apps: List[App], user: org.bson.types.ObjectId)

@main(user, "Spaces") {
	<div class="page-header">
		<div class="pull-right">
			<div class="btn-group">
				<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
					<span class="glyphicon glyphicon-plus"></span> Create or import a new record
				</button>
				<ul class="dropdown-menu" role="menu">
					@apps.map { app =>
						<li><a href="@routes.Records.create(app._id.toString())">@app.name</a></li>
					}
				</ul>
			</div>
		</div>
		<h1>My spaces</h1>
	</div>
	
	@if(spaceForm.hasGlobalErrors) {
		<div class="alert alert-danger alert-dismissable">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
			@spaceForm.globalError.message
		</div>
	}
	
	<!-- Space tabs -->
	<ul id="spaceTabs" class="nav nav-tabs">
		<li class="@if(activeSpace == null){active}">
			<a href="#tab-default" data-toggle="tab">All records</a>
		</li>
		@spaces.map { space =>
			<li tab-id="@space._id" class="spaceTab @if(space._id.equals(activeSpace)){active}">
				<a href="#@space._id" data-toggle="tab"><span class="spaceName">@space.name</span></a>
			</li>
		}
		<!-- Add new space button -->
		<li>
			<button data-toggle="modal" data-target="#spaceForm" class="btn btn-default">
				<span class="glyphicon glyphicon-plus"></span>
			</button>
		</li>
	</ul>
	
	<!-- Space content -->
	<!-- Default space -->
	<div id="spaceContent" class="tab-content">
		<div id="tab-default" class="tab-pane fade @if(activeSpace == null){active in}">
			<iframe id="iframe-default" src="@controllers.visualizations.routes.Visualizations.loading" height="420px" width="100%"></iframe>
			<div class="filters">
				<form class="form-inline" role="form">
					<div class="form-group col-lg-3">
						<label for="filterCreator-default" class="control-label">Created by: </label>						
						<select id="filterCreator-default" class="form-control"></select>						
					</div>
					<div class="form-group col-lg-3">
						<label for="filterOwner-default" class="control-label">Owned by: </label>						
						<select id="filterOwner-default" class="form-control"></select>						
					</div>
					<div class="form-group col-lg-6">
						<label for="filterDate-default" class="control-label">Created between: <span style="color:#707070" id="filterSliderRange-default">any</span></label>
						<div style="width:100%">						
						<input id="filterSlider-default" style="width:450px" />
						</div>						
					</div>
				</form>
			</div>
		</div>
		<!-- Custom spaces -->
		@spaces.map { space =>
			<div id="@space._id" class="space tab-pane fade @if(space._id.equals(activeSpace)){active in}">
				<div class="filters">
					<button class="btn btn-primary showCompare" style="margin-bottom: 5px;">
						<span class="glyphicon glyphicon-adjust"></span> Compare
					</button>
					<button class="btn btn-primary hideCompare hidden" style="margin-bottom: 5px;">
						<span class="glyphicon glyphicon-ban-circle"></span> Finished comparing
					</button>
					<div class="pull-right">
						<button data-toggle="modal" data-target="#recordForm-@space._id" class="btn btn-primary addRecord">
							<span class="glyphicon glyphicon-plus-sign"></span> Add a record to this space
						</button>
						<button class="btn btn-danger deleteSpace">
							<span class="glyphicon glyphicon-remove-sign"></span> Delete this space
						</button>
					</div>
				</div>
				<div class="compare1">
					<iframe id="iframe-@space._id" src="@controllers.visualizations.routes.Visualizations.loading" height="420px" width="100%"></iframe>
					<div class="filters">
						<form class="form-inline" role="form">
							<div class="form-group col-lg-3">
								<label for="filterCreator-@space._id" class="control-label">Created by: </label>
								<select id="filterCreator-@space._id" class="form-control"></select>
							</div>
							<div class="form-group col-lg-3">
								<label for="filterOwner-@space._id" class="control-label">Owned by: </label>
								<select id="filterOwner-@space._id" class="form-control"></select>
							</div>
							<div class="form-group col-lg-6">
								<label for="filterDate-@space._id" class="control-label">Created between: <span style="color:#707070" id="filterSliderRange-@space._id">any</span></label>
								<div style="width:100%">
									<input id="filterSlider-@space._id" style="width:450px" />
								</div>
							</div>
						</form>
					</div>					
				</div>
				<!-- Comparison view (hidden at the beginning) -->
				<div class="compare2 col-lg-6 hidden">
					<iframe id="iframe2-@space._id" src="@controllers.visualizations.routes.Visualizations.loading" height="420px" width="100%"></iframe>
					<div class="filters">
						<form class="form-inline" role="form">
							<div class="form-group col-lg-3">
								<label for="filterCreator2-@space._id" class="control-label">Created by: </label>
								<select id="filterCreator2-@space._id" class="form-control"></select>
							</div>
							<div class="form-group col-lg-3">
								<label for="filterOwner2-@space._id" class="control-label">Owned by: </label>
								<select id="filterOwner2-@space._id" class="form-control"></select>
							</div>
							<div class="form-group col-lg-6">
								<label for="filterDate2-@space._id" class="control-label">Created between: <span style="color:#707070" id="filterSlider2Range-@space._id">any</span></label>
								<div style="width:100%">
									<input id="filterSlider2-@space._id" style="width:450px" />
								</div>
							</div>
						</form>
					</div>		
				</div>
				
				<!-- Add records modal -->
				@helper.form(routes.Spaces.addRecords(space._id.toString())) {
					<div class="modal fade" id="recordForm-@space._id" role="dialog" aria-labelledby="label-@space._id" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									<h4 class="modal-title" id="label-@space._id">Add records to this space</h4>
								</div>
								<div class="modal-body">
									<div class="form-group">
										<input type="text" class="recordSearch form-control" name="recordSearch" placeholder="Search in your records">
										<!-- TODO: in JS -->
										@defining(Space.getRecords(space._id)) { spaceRecords =>
											@defining(records.filter(record => !spaceRecords.contains(record._id))) { recordsForResult =>
												@views.html.elements.recordsearchresults(recordsForResult)
											}
										}
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
									<button type="submit" class="btn btn-primary">Add</button>
								</div>
							</div> <!-- /.modal-content -->
						</div> <!-- /.modal-dialog -->
					</div> <!-- /.modal -->
				}
			</div>
		}
	</div>

	<!-- New space modal -->
	@helper.form(routes.Spaces.add, 'class -> "form-horizontal") {
		<div class="modal fade" id="spaceForm" role="dialog" aria-labelledby="spaceFormLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="spaceFormLabel">Create a new space</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="newSpaceName" class="col-lg-2 control-label">Name</label>
							<div class="col-lg-10">
								<input type="text" id="newSpaceName" class="form-control" placeholder="Name" name="name" value="@spaceForm("name").value" autofocus>
							</div>
						</div>
						<div class="form-group">
							<label for="newSpaceVisualization" class="col-lg-2 control-label">Visualization</label>
							<div class="col-lg-10">
								<select name="visualization" id="newSpaceVisualization" class="form-control">
									@User.findVisualizations(user).map { visualization =>
										<option value="@visualization._id">@visualization.name</option>
									}
								</select>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Create</button>
					</div>
				</div> <!-- /.modal-content -->
			</div> <!-- /.modal-dialog -->
		</div> <!-- /.modal -->
	}

	<!-- Load specific js -->
	<script type="text/javascript" src="@routes.Assets.at("javascripts/spaces.js")"></script>
}
