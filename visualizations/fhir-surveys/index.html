<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Surveys</title>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="/shared/css/app.css">
		<!-- jQuery needed for Bootstrap's JavaScript plugins -->
		<script type="text/javascript" src="//code.jquery.com/jquery-2.0.2.min.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular.min.js"></script>
		<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" defer></script>
		<script type="text/javascript" src="/shared/js/midata.js" defer></script>
		<script type="text/javascript" src="js/app.js" defer></script>
		<script type="text/javascript" src="js/survey.js" defer></script>
		<script type="text/javascript" src="js/controllers.js" defer></script>
	</head>
	<body>
		<div class="container-fluid" ng-app="surveys" ng-controller="SurveyCtrl" ng-cloak>
		
	
		  <div ng-if="nav.status=='pick'">
		    <div ng-controller="PickSurveyCtrl">
		       <div ng-show="surveys.length == 0">
		          <p class="head">Survey participation</p>
		          <p>This visualizations allows you to participate in surveys shared with you. You currently do not have any survey to participate.</p>
		       </div>
		       <div ng-show="(surveys.length > 0 || edit)">
		          <h1>Select a survey</h1>
			      <ul class="list-group">
				     <li class="list-group-item" ng-repeat="survey in surveys">
				        <a href="javascript:" ng-click="startSurvey(survey);">{{ survey.group.title }}</a>				    
				        <span class="badge" ng-show="survey.answered">Last Answered: {{ survey.answered.created | date }}</span>
				        <span class="badge" ng-show="survey.frequency">{{ survey.frequency }}</span>
				     </li>
				     <li class="list-group-item" ng-show="edit"><a href="javascript:" ng-click="createNew();">Create new survey</a>
			      </ul>
			   </div>
		     </div>
		  </div>
		  
		  <div ng-if="nav.status=='editsurvey'">
		    <div ng-controller="EditSurveyCtrl">
		       <form class="form-horizontal">
		       <div class="form-group">
		         <label for="title" class="control-label col-sm-4">Title</label>
		         <div class="col-sm-8">
		           <input id="title" class="form-control" type="text" ng-model="currentSurvey.activeSurvey.group.title">
		         </div>		         
		       </div>	
		       <div class="form-group">
		         <label for="version" class="control-label col-sm-4">Version</label>
		         <div class="col-sm-8">
		           <input id="version" class="form-control" type="text" ng-model="currentSurvey.activeSurvey.version">
		         </div>		         
		       </div>
		       
		       <button class="btn btn-default" ng-click="exit()">Exit</button>
		       <button class="btn btn-default" ng-click="save()">Save</button>
		       <button class="btn btn-default" ng-click="test()">Test Survey</button>		       
		       <button class="btn btn-default">Add Group</button>
		       <button class="btn btn-default" ng-click="addQuestion()">Add Question</button>
		       
		       <h3>Structure</h3>
		       <ul>
		         <li ng-repeat="q in currentSurvey.activeSurvey.group.question">
		           <a href="javascript:" ng-click="editQuestion(q)">{{ q.linkId }} XXX</a> : {{ q.text }}
		         </li>
		       </ul>
		       
		       </form>		       		       		       
		     </div>
		  </div>
		  
		  <div ng-if="nav.status=='editquestion'">
		    <div ng-controller="EditQuestionCtrl">
		       <form class="form-horizontal">
		       <div class="form-group">
		         <label for="linkId" class="control-label col-sm-4">Question ID</label>
		         <div class="col-sm-8">
		           <input id="linkId" class="form-control" type="text" ng-model="currentSurvey.activeQuestion.linkId">
		         </div>		         
		       </div>	
               <div class="form-group">
		         <label for="text" class="control-label col-sm-4">Text</label>
		         <div class="col-sm-8">
		           <textarea id="text" class="form-control" ng-model="currentSurvey.activeQuestion.text">
		           </textarea>
		         </div>		         
		       </div>	
               <div class="form-group">
		         <label for="type" class="control-label col-sm-4">Question Type</label>
		         <div class="col-sm-8">
		           <select id="type" class="form-control" ng-model="currentSurvey.activeQuestion.type" ng-options="qtype.value as qtype.label for qtype in questionTypes">
		           </select>
		         </div>		         
		       </div>
		       <button class="btn btn-primary" ng-click="ok()">ok</button>		       
	           </form>
	        </div>
	      </div>
	      
	      <div ng-if="nav.status=='answer'">
		    <div ng-controller="AnswerSurveyCtrl">
		      <script type="text/ng-template"  id="question_string.html">
                <input class="form-control" type="text" ng-model="question.rQuestion.answer[0].valueString">
              </script>
              <script type="text/ng-template"  id="question_text.html">
                 <textarea class="form-control" ng-model="question.rQuestion.answer[0].valueString"></textarea>
              </script>
              <script type="text/ng-template"  id="question_choice.html">
                <div ng-if="!question.question.repeats">
                 <div class="radio" ng-repeat="choice in question.question.option">
					     <label >
					       <input type="radio" ng-value="choice" ng-model="question.rQuestion.answer[0].valueCoding">
					       {{ choice.display }}					        
					     </label>					     			
			     </div>		
                </div>
                <div ng-if="question.question.repeats">
                   <div class="radio" ng-repeat="choice in question.question.option">
					     <label >
					       <input type="checkbox" ng-checked="isChecked(question, choice.value)" ng-changed="changeChecked(question, choice.value)">
					       {{ choice.display }}					       
					     </label>			
				   </div>		
                </div>
              </script>
              <script type="text/ng-template"  id="question_boolean.html">
                 <div class="radio">
					<label>
					  <input type="radio" value="true" ng-model="question.rQuestion.answer[0].valueBoolean">
					       Yes
					</label>
				  </div>
				  <div class="radio">
					<label>
					  <input type="radio" value="false" ng-model="question.rQuestion.answer[0].valueBoolean">
 				       No
  			        </label>			
				  </div>		    
              </script>
              
              <script type="text/ng-template"  id="question.html">                
                <div class="form-group">
		         <label for="{{ question.question.linkId }}" class="control-label">{{ question.question.text }}</label>
		         <div class="col-sm-12" ng-include="templateName(question.question)">		           
		         </div>		         
		       </div>	
              </script>
		    		    
		      <div class="pull-left">
				 <a href="javascript:" ng-click="prev();">Back</a>
			  </div>
			  <div class="pull-right">
				 <a href="javascript:" ng-click="cancel()">Cancel</a>
			  </div>
		      <p class="text-center">Step {{ (currentSurvey.activeStepIdx + 1) }} of {{ currentSurvey.pages.length }}</p>
		      <form>
		      <h1>{{ currentSurvey.activePage.group.title }}</h1>	
		      <p>{{ currentSurvey.activePage.group.text }}</p>
		      
		      <div ng-repeat="question in currentSurvey.activePage.question">
		        <div ng-include="'question.html'"></div>
		      </div>
		      
		      <button class="btn btn-primary" ng-click="next()">Next</button>			
			  <div ng-hide="currentSurvey.activePage.group.required">
				  <a href="javascript:" ng-click="skip()">Skip this question</a>
			  </div>
			  </form>
		    </div>	
		    
		    <div ng-if="nav.status=='answer'">
		    <div ng-controller="AnswerSurveyCtrl">
		      <p>Your answers have been recorded. Thank you for participation.</p>
		      <button ng-click="back()">Back to list</button>
		    </div>
		    </div>	  
		  </div>		  	  
	</body>
</html>
